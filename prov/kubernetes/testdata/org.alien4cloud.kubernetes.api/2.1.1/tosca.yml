tosca_definitions_version: alien_dsl_2_0_0

metadata:
  template_name: org.alien4cloud.kubernetes.api
  template_version: 2.1.1
  template_author: alien4cloud

description: "Kubernetes types that fit to K8S api, used by K8S topology modifiers and describe K8S matchable resources ; modified for Jobs support."

data_types:
  org.alien4cloud.kubernetes.api.datatypes.LocalObjectReference:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      name:
        type: string
  org.alien4cloud.kubernetes.api.datatypes.ServicePort:
    description: "c.f. https://v1-6.docs.kubernetes.io/docs/api-reference/v1.6/#serviceport-v1-core"
    derived_from: tosca.datatypes.Root
    properties:
      name:
        type: string
        description: "The name of this port within the service. This must be a DNS_LABEL. All ports within a ServiceSpec must have unique names. This maps to the 'Name' field in EndpointPort objects. Optional if only one ServicePort is defined on this service."
      nodePort:
        type: integer
        description: "The port on each node on which this service is exposed when type=NodePort or LoadBalancer. Usually assigned by the system. If specified, it will be allocated to the service if unused or else creation of the service will fail. Default is to auto-allocate a port if the ServiceType of this Service requires one. More info: http://kubernetes.io/docs/user-guide/services#type--nodeport"
        required: false
      port:
        type: integer
        description: "The port that will be exposed by this service."
        required: false
      protocol:
        type: string
        description: "The IP protocol for this port. Supports \"TCP\" and \"UDP\". Default is TCP."
        default: TCP
      targetPort:
        type: string
        description: "Perhaps more interesting is that targetPort can be a string, referring to the name of a port in the backend Pods."
        required: false
  org.alien4cloud.kubernetes.api.datatypes.EndpointSubsets:
    description: "c.f. https://v1-6.docs.kubernetes.io/docs/api-reference/v1.6/#endpointsubset-v1-core"
    derived_from: tosca.datatypes.Root
    properties:
      addresses:
        type: list
        entry_schema:
          type: org.alien4cloud.kubernetes.api.datatypes.IP
      ports:
        type: list
        entry_schema:
          type: org.alien4cloud.kubernetes.api.datatypes.Port
  org.alien4cloud.kubernetes.api.datatypes.IP:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      ip:
        type: string
  org.alien4cloud.kubernetes.api.datatypes.Port:
    description: "c.f. https://v1-6.docs.kubernetes.io/docs/api-reference/v1.6/#endpointport-v1-core"
    derived_from: tosca.datatypes.Root
    properties:
      port:
        type: integer
      protocol:
        type: string
        description: "Protocol for port. Must be UDP or TCP. Defaults to \"TCP\"."
        default: TCP
  org.alien4cloud.kubernetes.api.datatypes.ServiceSpec:
    description: "c.f. https://v1-6.docs.kubernetes.io/docs/api-reference/v1.6/#servicespec-v1-core"
    derived_from: tosca.datatypes.Root
    properties:
      clusterIP:
        type: string
        description: "clusterIP is the IP address of the service and is usually assigned randomly by the master. If an address is specified manually and is not in use by others, it will be allocated to the service; otherwise, creation of the service will fail. This field can not be changed through updates. Valid values are \"None\", empty string (\"\"), or a valid IP address. \"None\" can be specified for headless services when proxying is not required. Only applies to types ClusterIP, NodePort, and LoadBalancer. Ignored if type is ExternalName. More info: http://kubernetes.io/docs/user-guide/services#virtual-ips-and-service-proxies"
        required: false
      deprecatedPublicIPs:
        type: string
        description: "array  deprecatedPublicIPs is deprecated and replaced by the externalIPs field with almost the exact same semantics. This field is retained in the v1 API for compatibility until at least 8/20/2016. It will be removed from any new API revisions. If both deprecatedPublicIPs and externalIPs are set, deprecatedPublicIPs is used."
        required: false
      externalIPs:
        type: string
        description: "array  externalIPs is a list of IP addresses for which nodes in the cluster will also accept traffic for this service. These IPs are not managed by Kubernetes. The user is responsible for ensuring that traffic arrives at a node with this IP. A common example is external load-balancers that are not part of the Kubernetes system. A previous form of this functionality exists as the deprecatedPublicIPs field. When using this field, callers should also clear the deprecatedPublicIPs field."
        required: false
      externalName:
        type: string
        description: "externalName is the external reference that kubedns or equivalent will return as a CNAME record for this service. No proxying will be involved. Must be a valid DNS name and requires Type to be ExternalName."
        required: false
      loadBalancerIP:
        type: string
        description: "Only applies to Service Type: LoadBalancer LoadBalancer will get created with the IP specified in this field. This feature depends on whether the underlying cloud-provider supports specifying the loadBalancerIP when a load balancer is created. This field will be ignored if the cloud-provider does not support the feature."
        required: false
      loadBalancerSourceRanges:
        type: string
        description: "array  If specified and supported by the platform, this will restrict traffic through the cloud-provider load-balancer will be restricted to the specified client IPs. This field will be ignored if the cloud-provider does not support the feature.\" More info: http://kubernetes.io/docs/user-guide/services-firewalls"
        required: false
      ports:
        type: list
        description: "The list of ports that are exposed by this service. More info: http://kubernetes.io/docs/user-guide/services#virtual-ips-and-service-proxies"
        required: false
        entry_schema:
          type: org.alien4cloud.kubernetes.api.datatypes.ServicePort
      selector:
        type: map
        description: "Route service traffic to pods with label keys and values matching this selector. If empty or not present, the service is assumed to have an external process managing its endpoints, which Kubernetes will not modify. Only applies to types ClusterIP, NodePort, and LoadBalancer. Ignored if type is ExternalName. More info: http://kubernetes.io/docs/user-guide/services#overview"
        required: false
        entry_schema:
          type: string
      sessionAffinity:
        type: string
        description: "Supports \"ClientIP\" and \"None\". Used to maintain session affinity. Enable client IP based session affinity. Must be ClientIP or None. Defaults to None. More info: http://kubernetes.io/docs/user-guide/services#virtual-ips-and-service-proxies"
        required: false
      service_type:
        type: string
        description: "type determines how the Service is exposed. Defaults to ClusterIP. Valid options are ExternalName, ClusterIP, NodePort, and LoadBalancer. \"ExternalName\" maps to the specified externalName. \"ClusterIP\" allocates a cluster-internal IP address for load-balancing to endpoints. Endpoints are determined by the selector or if that is not specified, by manual construction of an Endpoints object. If clusterIP is \"None\", no virtual IP is allocated and the endpoints are published as a set of endpoints rather than a stable IP. \"NodePort\" builds on ClusterIP and allocates a port on every node which routes to the clusterIP. \"LoadBalancer\" builds on NodePort and creates an external load-balancer (if supported in the current cloud) which routes to the clusterIP. More info: http://kubernetes.io/docs/user-guide/services#overview"
        required: false
  org.alien4cloud.kubernetes.api.datatypes.ControllerSpec:
    description: "Used to provied template of PodTemplateSpec to controllers as Job, Deployment, and in the future, StatefulSet"
    derived_from: tosca.datatypes.Root
    properties:
      template:
        type: org.alien4cloud.kubernetes.api.datatypes.PodTemplateSpec
        description: "Template describes the pods that will be created."
        required: false
  org.alien4cloud.kubernetes.api.datatypes.DeploymentSpec:
    description: "c.f. https://kubernetes.io/docs/api-reference/v1.6/#deploymentspec-v1beta1-apps"
    derived_from: org.alien4cloud.kubernetes.api.datatypes.ControllerSpec
    properties:
      minReadySeconds:
        type: integer
        description: "Minimum number of seconds for which a newly created pod should be ready without any of its container crashing, for it to be considered available. Defaults to 0 (pod will be considered available as soon as it is ready)"
        required: false
      paused:
        type: boolean
        description: "Indicates that the deployment is paused."
        required: false
      progressDeadlineSeconds:
        type: integer
        description: "The maximum time in seconds for a deployment to make progress before it is considered to be failed. The deployment controller will continue to process failed deployments and a condition with a ProgressDeadlineExceeded reason will be surfaced in the deployment status. Once autoRollback is implemented, the deployment controller will automatically rollback failed deployments. Note that progress will not be estimated during the time a deployment is paused. Defaults to 600s."
        required: false
      replicas:
        type: integer
        description: "Number of desired pods. This is a pointer to distinguish between explicit zero and not specified. Defaults to 1."
        required: false
      revisionHistoryLimit:
        type: integer
        description: "The number of old ReplicaSets to retain to allow rollback. This is a pointer to distinguish between explicit zero and not specified. Defaults to 2."
        required: false
      rollbackTo:
        type: string
        description: "The config this deployment is rolling back to. Will be cleared after rollback is done."
        required: false
      selector:
        type: string
        description: "Label selector for pods. Existing ReplicaSets whose pods are selected by this will be the ones affected by this deployment."
        required: false
      strategy:
        type: string
        description: "The deployment strategy to use to replace existing pods with new ones."
        required: false
  org.alien4cloud.kubernetes.api.datatypes.JobSpec:
    description: "c.f. https://v1-6.docs.kubernetes.io/docs/api-reference/v1.6/#jobspec-v1-batch"
    derived_from: org.alien4cloud.kubernetes.api.datatypes.ControllerSpec
    properties:
      activeDeadlineSeconds:
        type: integer
        description: "Optional duration in seconds relative to the startTime that the job may be active before the system tries to terminate it; value must be positive integer"
        required: false
      completions:
        type: integer
        description: "Completions specifies the desired number of successfully finished pods the job should be run with."
        required: false
      manualSelector:
        type: boolean
        description: "ManualSelector controls generation of pod labels and pod selectors. When false or unset, the system pick labels unique to this job and appends those labels to the pod template."
        required: false
      parallelism:
        type: integer
        description: "Parallelism specifies the maximum desired number of pods the job should run at any given time."
        required: false
      selector:
        type: string
        description: "Label query over pods that should match the pod count. Normally, the system sets this field for you"
        required: false
  org.alien4cloud.kubernetes.api.datatypes.PodTemplateSpec:
    description: |
      c.f. hhttps://kubernetes.io/docs/api-reference/v1.6/#podtemplatespec-v1-core For instance:
        metadata:
          labels:
            app: nginx
    derived_from: tosca.datatypes.Root
    properties:
      metadata:
        type: org.alien4cloud.kubernetes.api.datatypes.Metadata
        description: "Standard object's metadata. More info: http://releases.k8s.io/HEAD/docs/devel/api-conventions.md#metadata"
        required: false
      spec:
        type: org.alien4cloud.kubernetes.api.datatypes.PodSpec
        description: "Specification of the desired behavior of the pod. More info: http://releases.k8s.io/HEAD/docs/devel/api-conventions.md#spec-and-status"
        required: false
  org.alien4cloud.kubernetes.api.datatypes.Metadata:
    description: |
      c.f. hhttps://kubernetes.io/docs/api-reference/v1.6/#podtemplatespec-v1-core For instance:
        metadata:
          labels:
            app: nginx
    derived_from: tosca.datatypes.Root
    properties:
      labels:
        type: map
        required: false
        entry_schema:
          type: string
      annotations:
        type: map
        required: false
        entry_schema:
          type: string
  org.alien4cloud.kubernetes.api.datatypes.PodSpec:
    description: "c.f. hhttps://kubernetes.io/docs/api-reference/v1.6/#podtspec-v1-core"
    derived_from: tosca.datatypes.Root
    properties:
      activeDeadlineSeconds:
        type: integer
        description: "Optional duration in seconds the pod may be active on the node relative to StartTime before the system will actively try to mark it failed and kill associated containers. Value must be a positive integer."
        required: false
      affinity:
        type: org.alien4cloud.kubernetes.api.datatypes.Affinity
        description: "If specified, the pod's scheduling constraints"
        required: false
      automountServiceAccountToken:
        type: boolean
        description: "AutomountServiceAccountToken indicates whether a service account token should be automatically mounted."
        required: false
      dnsPolicy:
        type: string
        description: "Set DNS policy for containers within the pod. One of 'ClusterFirstWithHostNet', 'ClusterFirst' or 'Default'. Defaults to \"ClusterFirst\". To have DNS options set along with hostNetwork, you have to specify DNS policy explicitly to 'ClusterFirstWithHostNet'."
        required: false
      hostIPC:
        type: boolean
        description: "Use the host's ipc namespace. Optional: Default to false."
        required: false
      hostNetwork:
        type: boolean
        description: "Host networking requested for this pod. Use the host's network namespace. If this option is set, the ports that will be used must be specified. Default to false."
        required: false
      hostPID:
        type: boolean
        description: "Use the host's pid namespace. Optional: Default to false."
        required: false
      hostname:
        type: string
        description: "Specifies the hostname of the Pod If not specified, the pod's hostname will be set to a system-defined value."
        required: false
      imagePullSecrets:
        type: list
        description: "ImagePullSecrets is an optional list of references to secrets in the same namespace to use for pulling any of the images used by this PodSpec. If specified, these secrets will be passed to individual puller implementations for them to use. For example, in the case of docker, only DockerConfig type secrets are honored. More info: http://kubernetes.io/docs/user-guide/images#specifying-imagepullsecrets-on-a-pod"
        required: false
        entry_schema:
          type: org.alien4cloud.kubernetes.api.datatypes.LocalObjectReference
      initContainers:
        type: org.alien4cloud.kubernetes.api.datatypes.ContainerSpec
        description: "array List of initialization containers belonging to the pod. Init containers are executed in order prior to containers being started. If any init container fails, the pod is considered to have failed and is handled according to its restartPolicy. The name for an init container or normal container must be unique among all containers. Init containers may not have Lifecycle actions, Readiness probes, or Liveness probes. The resourceRequirements of an init container are taken into account during scheduling by finding the highest request/limit for each resource type, and then using the max of of that value or the sum of the normal containers. Limits are applied to init containers in a similar fashion. Init containers cannot currently be added or removed. Cannot be updated. More info: http://kubernetes.io/docs/user-guide/containers"
        required: false
      nodeName:
        type: string
        description: "NodeName is a request to schedule this pod onto a specific node. If it is non-empty, the scheduler simply schedules this pod onto that node, assuming that it fits resource requirements."
        required: false
      nodeSelector:
        type: map
        description: "NodeSelector is a selector which must be true for the pod to fit on a node. Selector which must match a node's labels for the pod to be scheduled on that node. More info: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector"
        required: false
        entry_schema:
          type: string
      restartPolicy:
        type: string
        description: "Restart policy for all containers within the pod. One of Always, OnFailure, Never. Default to Always. More info: http://kubernetes.io/docs/user-guide/pod-states#restartpolicy"
        required: false
      schedulerName:
        type: string
        description: "If specified, the pod will be dispatched by specified scheduler. If not specified, the pod will be dispatched by default scheduler."
        required: false
      serviceAccount:
        type: string
        description: "DeprecatedServiceAccount is a depreciated alias for ServiceAccountName. Deprecated: Use serviceAccountName instead."
        required: false
      serviceAccountName:
        type: string
        description: "ServiceAccountName is the name of the ServiceAccount to use to run this pod. More info: http://releases.k8s.io/HEAD/docs/design/service_accounts.md"
        required: false
      subdomain:
        type: string
        description: "If specified, the fully qualified Pod hostname will be \"...svc.\". If not specified, the pod will not have a domainname at all."
        required: false
      terminationGracePeriodSeconds:
        type: integer
        description: "Optional duration in seconds the pod needs to terminate gracefully. May be decreased in delete request. Value must be non-negative integer. The value zero indicates delete immediately. If this value is nil, the default grace period will be used instead. The grace period is the duration in seconds after the processes running in the pod are sent a termination signal and the time when the processes are forcibly halted with a kill signal. Set this value longer than the expected cleanup time for your process. Defaults to 30 seconds."
        required: false
  org.alien4cloud.kubernetes.api.datatypes.ContainerPort:
    description: "c.f. hhttps://kubernetes.io/docs/api-reference/v1.6/#containerport-v1-core"
    derived_from: tosca.datatypes.Root
    properties:
      containerPort:
        type: integer
        description: "Number of port to expose on the pod's IP address."
      name:
        type: string
        description: "If specified, this must be an IANA_SVC_NAME and unique within the pod. Each named port in a pod must have a unique name. Name for the port that can be referred to by services."
        required: false
      hostIP:
        type: string
        description: "What host IP to bind the external port to."
        required: false
      hostPort:
        type: integer
        description: "Number of port to expose on the host. If specified, this must be a valid port number, 0 < x < 65536. If HostNetwork is specified, this must match ContainerPort. Most containers do not need this."
        required: false
      protocol:
        type: string
        description: "Protocol for port. Must be UDP or TCP. Defaults to \"TCP\"."
        required: false
        default: TCP
  org.alien4cloud.kubernetes.api.datatypes.ContainerEnv:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      name:
        type: string
      value:
        type: string
  org.alien4cloud.kubernetes.api.datatypes.Lifecycle:
    description: |
      Lifecycle describes actions that the management system should take in response to container lifecycle events.
      For the PostStart and PreStop lifecycle handlers, management of the container blocks until the action is complete, unless the container process fails, in which case the handler is aborted.
    derived_from: tosca.datatypes.Root
    properties:
      postStart:
        type: org.alien4cloud.kubernetes.api.datatypes.Handler
        description: |
          PostStart is called immediately after a container is created.
          If the handler fails, the container is terminated and restarted according to its restart policy.
          Other management of the container blocks until the hook completes.
          More info: https://kubernetes.io/docs/concepts/containers/container-lifecycle-hooks/#container-hooks
        required: false
      preStop:
        type: org.alien4cloud.kubernetes.api.datatypes.Handler
        description: |
          PreStop is called immediately before a container is terminated.
          The container is terminated after the handler completes.
          The reason for termination is passed to the handler.
          Regardless of the outcome of the handler, the container is eventually terminated.
          Other management of the container blocks until the hook completes.
          More info: https://kubernetes.io/docs/concepts/containers/container-lifecycle-hooks/#container-hooks
        required: false
  org.alien4cloud.kubernetes.api.datatypes.Handler:
    description: |
      Handler defines a specific action that should be taken.
      One and only one of the following should be specified.
    derived_from: tosca.datatypes.Root
    properties:
      exec:
        type: org.alien4cloud.kubernetes.api.datatypes.ExecAction
        description: "Exec specifies the action to take."
        required: false
      httpGet:
        type: org.alien4cloud.kubernetes.api.datatypes.HTTPGetAction
        description: "HTTPGet specifies the http request to perform."
        required: false
      tcpSocket:
        type: org.alien4cloud.kubernetes.api.datatypes.TCPSocketAction
        description: "TCPSocket specifies an action involving a TCP port. TCP hooks not yet supported"
        required: false
  org.alien4cloud.kubernetes.api.datatypes.ExecAction:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      command:
        type: list
        description: |
          Command is the command line to execute inside the container, the working directory for the command is root ('/') in the container's filesystem.
          The command is simply exec'd, it is not run inside a shell, so traditional shell instructions ('|', etc) won't work.
          To use a shell, you need to explicitly call out to that shell.
          Exit status of 0 is treated as live/healthy and non-zero is unhealthy.
        required: false
        entry_schema:
          type: string
  org.alien4cloud.kubernetes.api.datatypes.HTTPHeader:
    description: "HTTPHeader describes a custom header to be used in HTTP probes"
    derived_from: tosca.datatypes.Root
    properties:
      name:
        type: string
        description: "The header field name"
      value:
        type: string
        description: "The header field value"
  org.alien4cloud.kubernetes.api.datatypes.HTTPGetAction:
    description: "HTTPGetAction describes an action based on HTTP Get requests."
    derived_from: tosca.datatypes.Root
    properties:
      host:
        type: string
        description: "Host name to connect to, defaults to the pod IP. You probably want to set \"Host\" in httpHeaders instead."
        required: false
      httpHeaders:
        type: list
        description: "Custom headers to set in the request. HTTP allows repeated headers."
        required: false
        entry_schema:
          type: org.alien4cloud.kubernetes.api.datatypes.HTTPHeader
      path:
        type: string
        description: "Path to access on the HTTP server."
        required: false
      port:
        type: integer
        description: "Name or number of the port to access on the container. Number must be in the range 1 to 65535. Name must be an IANA_SVC_NAME."
        required: false
      scheme:
        type: string
        description: "Scheme to use for connecting to the host. Defaults to HTTP."
        required: false
  org.alien4cloud.kubernetes.api.datatypes.TCPSocketAction:
    description: "TCPSocketAction describes an action based on opening a socket"
    derived_from: tosca.datatypes.Root
    properties:
      host:
        type: string
        description: "Host name to connect to, defaults to the pod IP. You probably want to set \"Host\" in httpHeaders instead."
        required: false
      port:
        type: integer
        description: "Name or number of the port to access on the container. Number must be in the range 1 to 65535. Name must be an IANA_SVC_NAME."
        required: false
  org.alien4cloud.kubernetes.api.datatypes.Probe:
    description: "Probe describes a health check to be performed against a container to determine whether it is alive or ready to receive traffic."
    derived_from: tosca.datatypes.Root
    properties:
      exec:
        type: org.alien4cloud.kubernetes.api.datatypes.ExecAction
        description: "Exec specifies the action to take."
        required: false
      httpGet:
        type: org.alien4cloud.kubernetes.api.datatypes.HTTPGetAction
        description: "HTTPGet specifies the http request to perform."
        required: false
      tcpSocket:
        type: org.alien4cloud.kubernetes.api.datatypes.TCPSocketAction
        description: "TCPSocket specifies an action involving a TCP port. TCP hooks not yet supported"
        required: false
      failureThreshold:
        type: integer
        description: "Minimum consecutive failures for the probe to be considered failed after having succeeded. Defaults to 3. Minimum value is 1."
        required: false
      initialDelaySeconds:
        type: integer
        description: "Number of seconds after the container has started before liveness probes are initiated. More info: https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle#container-probes"
        required: false
      periodSeconds:
        type: integer
        description: "How often (in seconds) to perform the probe. Default to 10 seconds. Minimum value is 1."
        required: false
      successThreshold:
        type: integer
        description: "Minimum consecutive successes for the probe to be considered successful after having failed. Defaults to 1. Must be 1 for liveness. Minimum value is 1."
        required: false
      timeoutSeconds:
        type: integer
        description: "Number of seconds after which the probe times out. Defaults to 1 second. Minimum value is 1. More info: https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle#container-probes"
        required: false
  org.alien4cloud.kubernetes.api.datatypes.ContainerSpec:
    description: "c.f. hhttps://kubernetes.io/docs/api-reference/v1.6/#container-v1-core"
    derived_from: tosca.datatypes.Root
    properties:
      args:
        type: list
        description: "array  Arguments to the entrypoint. The docker image's CMD is used if this is not provided. Variable references $(VAR_NAME) are expanded using the container's environment. If a variable cannot be resolved, the reference in the input string will be unchanged. The $(VAR_NAME) syntax can be escaped with a double $$, ie: $$(VAR_NAME). Escaped references will never be expanded, regardless of whether the variable exists or not. Cannot be updated. More info: http://kubernetes.io/docs/user-guide/containers#containers-and-commands"
        required: false
        entry_schema:
          type: string
      command:
        type: list
        description: "Entrypoint array. Not executed within a shell. The docker image's ENTRYPOINT is used if this is not provided. Variable references $(VAR_NAME) are expanded using the container's environment. If a variable cannot be resolved, the reference in the input string will be unchanged. The $(VAR_NAME) syntax can be escaped with a double $$, ie: $$(VAR_NAME). Escaped references will never be expanded, regardless of whether the variable exists or not. Cannot be updated. More info: http://kubernetes.io/docs/user-guide/containers#containers-and-commands"
        required: false
        entry_schema:
          type: string
      env:
        type: list
        description: "List of environment variables to set in the container. Cannot be updated."
        required: false
        entry_schema:
          type: org.alien4cloud.kubernetes.api.datatypes.ContainerEnv
      image:
        type: string
        description: "Docker image name. More info: http://kubernetes.io/docs/user-guide/images"
        required: false
      imagePullPolicy:
        type: string
        description: "Image pull policy. One of Always, Never, IfNotPresent. Defaults to Always if :latest tag is specified, or IfNotPresent otherwise. Cannot be updated. More info: http://kubernetes.io/docs/user-guide/images#updating-images"
        required: false
        default: Always
      lifecycle:
        type: org.alien4cloud.kubernetes.api.datatypes.Lifecycle
        description: "Actions that the management system should take in response to container lifecycle events. Cannot be updated."
        required: false
      livenessProbe:
        type: org.alien4cloud.kubernetes.api.datatypes.Probe
        description: "Periodic probe of container liveness. Container will be restarted if the probe fails. Cannot be updated. More info: http://kubernetes.io/docs/user-guide/pod-states#container-probes"
        required: false
      name:
        type: string
        description: "Name of the container specified as a DNS_LABEL. Each container in a pod must have a unique name (DNS_LABEL). Cannot be updated."
        required: false
      ports:
        type: list
        description: "array List of ports to expose from the container. Exposing a port here gives the system additional information about the network connections a container uses, but is primarily informational. Not specifying a port here DOES NOT prevent that port from being exposed. Any port which is listening on the default \"0.0.0.0\" address inside a container will be accessible from the network. Cannot be updated."
        required: false
        entry_schema:
          type: org.alien4cloud.kubernetes.api.datatypes.ContainerPort
      readinessProbe:
        type: org.alien4cloud.kubernetes.api.datatypes.Probe
        description: "Periodic probe of container service readiness. Container will be removed from service endpoints if the probe fails. Cannot be updated. More info: http://kubernetes.io/docs/user-guide/pod-states#container-probes"
        required: false
      resources:
        type: org.alien4cloud.kubernetes.api.datatypes.ResourceRequirements
        description: "Compute Resources required by this container. Cannot be updated. More info: http://kubernetes.io/docs/concepts/storage/persistent-volumes/#resources"
        required: false
      stdin:
        type: boolean
        description: "Whether this container should allocate a buffer for stdin in the container runtime. If this is not set, reads from stdin in the container will always result in EOF. Default is false."
        required: false
      stdinOnce:
        type: boolean
        description: "Whether the container runtime should close the stdin channel after it has been opened by a single attach. When stdin is true the stdin stream will remain open across multiple attach sessions. If stdinOnce is set to true, stdin is opened on container start, is empty until the first client attaches to stdin, and then remains open and accepts data until the client disconnects, at which time stdin is closed and remains closed until the container is restarted. If this flag is false, a container processes that reads from stdin will never receive an EOF. Default is false"
        required: false
      terminationMessagePath:
        type: string
        description: "Optional: Path at which the file to which the container's termination message will be written is mounted into the container's filesystem. Message written is intended to be brief final status, such as an assertion failure message. Will be truncated by the node if greater than 4096 bytes. The total message length across all containers will be limited to 12kb. Defaults to /dev/termination-log. Cannot be updated."
        required: false
      terminationMessagePolicy:
        type: string
        description: "Indicate how the termination message should be populated. File will use the contents of terminationMessagePath to populate the container status message on both success and failure. FallbackToLogsOnError will use the last chunk of container log output if the termination message file is empty and the container exited with an error. The log output is limited to 2048 bytes or 80 lines, whichever is smaller. Defaults to File. Cannot be updated."
        required: false
      tty:
        type: boolean
        description: "Whether this container should allocate a TTY for itself, also requires 'stdin' to be true. Default is false."
        required: false
      volumeMounts:
        type: list
        description: "array Pod volumes to mount into the container's filesystem. Cannot be updated."
        required: false
        entry_schema:
          type: org.alien4cloud.kubernetes.api.datatypes.VolumeMount
      workingDir:
        type: string
        description: "Container's working directory. If not specified, the container runtime's default will be used, which might be configured in the container image. Cannot be updated."
        required: false
  org.alien4cloud.kubernetes.api.datatypes.VolumeMount:
    description: "c.f. hhttps://kubernetes.io/docs/api-reference/v1.6/#volumemount-v1-core"
    derived_from: tosca.datatypes.Root
    properties:
      mountPath:
        type: string
      name:
        type: string
      subPath:
        type: string
        description: "Path within the volume from which the container's volume should be mounted. Defaults to '' (volume's root)."
        required: false
      readOnly:
        type: boolean
        description: "Mounted read-only if true, read-write otherwise (false or unspecified). Defaults to false."
        required: false
        default: false
  org.alien4cloud.kubernetes.api.datatypes.ResourceRequirements:
    description: "c.f. hhttps://kubernetes.io/docs/api-reference/v1.6/#resourcerequirements-v1-core"
    derived_from: tosca.datatypes.Root
    properties:
      limits:
        type: org.alien4cloud.kubernetes.api.datatypes.ResourceRequest
        description: "Limits describes the maximum amount of compute resources allowed. More info: http://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/"
        required: false
      requests:
        type: org.alien4cloud.kubernetes.api.datatypes.ResourceRequest
        description: "Requests describes the minimum amount of compute resources required. If Requests is omitted for a container, it defaults to Limits if that is explicitly specified, otherwise to an implementation-defined value. More info: http://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/"
        required: false
  org.alien4cloud.kubernetes.api.datatypes.ResourceRequest:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      memory:
        type: scalar-unit.size
        required: false
      cpu:
        type: float
        required: false
      nvidia.com/gpu:
        type: integer
        required: false
  org.alien4cloud.kubernetes.api.datatypes.Affinity:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      nodeAffinity:
        type: org.alien4cloud.kubernetes.api.datatypes.NodeAffinity
        description: "Describes node affinity scheduling rules for the pod (e.g put this pod in any node matching a provided expression of labels / values couple)."
      podAntiAffinity:
        type: org.alien4cloud.kubernetes.api.datatypes.PodAntiAffinity
        description: "Describes pod anti-affinity scheduling rules (e.g. avoid putting this pod in the same node, zone, etc. as some other pod(s))."
  org.alien4cloud.kubernetes.api.datatypes.NodeAffinity:
    description: "see https://v1-7.docs.kubernetes.io/docs/api-reference/v1.7/#nodeaffinity-v1-core"
    derived_from: tosca.datatypes.Root
    properties:
      preferredDuringSchedulingIgnoredDuringExecution:
        type: list
        required: false
        entry_schema:
          type: org.alien4cloud.kubernetes.api.datatypes.PreferredSchedulingTerm
  org.alien4cloud.kubernetes.api.datatypes.PreferredSchedulingTerm:
    description: "see https://v1-7.docs.kubernetes.io/docs/api-reference/v1.7/#preferredschedulingterm-v1-core"
    derived_from: tosca.datatypes.Root
    properties:
      preference:
        type: org.alien4cloud.kubernetes.api.datatypes.NodeSelectorTerm
        description: "A node selector term, associated with the corresponding weight"
        required: false
      weight:
        type: integer
        description: "Weight associated with matching the corresponding nodeSelectorTerm, in the range 1-100."
        required: false
  org.alien4cloud.kubernetes.api.datatypes.NodeSelectorTerm:
    description: "see https://v1-7.docs.kubernetes.io/docs/api-reference/v1.7/#nodeselectorterm-v1-core"
    derived_from: tosca.datatypes.Root
    properties:
      matchExpressions:
        type: list
        description: "matchExpressions is a list of node selector requirements. The requirements are ANDed."
        entry_schema:
          type: org.alien4cloud.kubernetes.api.datatypes.NodeSelectorRequirement
  org.alien4cloud.kubernetes.api.datatypes.NodeSelectorRequirement:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      key:
        type: string
        description: "key is the label key that the selector applies to."
        required: false
      operator:
        type: string
        description: "operator represents a key's relationship to a set of values. Valid operators ard In, NotIn, Exists and DoesNotExist."
        required: false
      values:
        type: list
        description: "values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. This array is replaced during a strategic merge patch."
        required: false
        entry_schema:
          type: string
  org.alien4cloud.kubernetes.api.datatypes.PodAntiAffinity:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      preferredDuringSchedulingIgnoredDuringExecution:
        type: list
        required: false
        entry_schema:
          type: org.alien4cloud.kubernetes.api.datatypes.WeightedPodAffinityTerm
  org.alien4cloud.kubernetes.api.datatypes.WeightedPodAffinityTerm:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      podAffinityTerm:
        type: org.alien4cloud.kubernetes.api.datatypes.PodAffinityTerm
        description: "A node selector term, associated with the corresponding weight."
        required: false
      weight:
        type: integer
        description: "Weight associated with matching the corresponding nodeSelectorTerm, in the range 1-100."
        required: false
  org.alien4cloud.kubernetes.api.datatypes.PodAffinityTerm:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      labelSelector:
        type: org.alien4cloud.kubernetes.api.datatypes.LabelSelector
        description: "A label query over a set of resources, in this case pods."
        required: false
      namespaces:
        type: list
        description: "namespaces specifies which namespaces the org.alien4cloud.kubernetes.api.datatypes.LabelSelector applies to (matches against); nil list means \"this pod's namespace,\" empty list means \"all namespaces\" The json tag here is not \"omitempty\" since we need to distinguish nil and empty. See https://golang.org/pkg/encoding/json/#Marshal for more details."
        entry_schema:
          type: string
      topologyKey:
        type: string
        description: "This pod should be co-located (affinity) or not co-located (anti-affinity) with the pods matching the org.alien4cloud.kubernetes.api.datatypes.LabelSelector in the specified namespaces, where co-located is defined as running on a node whose value of the label with key topologyKey matches that of any node on which any of the selected pods is running. For PreferredDuringScheduling pod anti-affinity, empty topologyKey is interpreted as \"all topologies\" (\"all topologies\" here means all the topologyKeys indicated by scheduler command-line argument --failure-domains); for affinity and for RequiredDuringScheduling pod anti-affinity, empty topologyKey is not allowed."
  org.alien4cloud.kubernetes.api.datatypes.LabelSelector:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      matchExpressions:
        type: list
        description: "matchExpressions is a list of label selector requirements. The requirements are ANDed."
        required: false
        entry_schema:
          type: org.alien4cloud.kubernetes.api.datatypes.org.alien4cloud.kubernetes.api.datatypes.LabelSelectorRequirement
  org.alien4cloud.kubernetes.api.datatypes.org.alien4cloud.kubernetes.api.datatypes.LabelSelectorRequirement:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      key:
        type: string
        description: "key is the label key that the selector applies to."
        required: false
      operator:
        type: string
        description: "operator represents a key's relationship to a set of values. Valid operators ard In, NotIn, Exists and DoesNotExist."
        required: false
      values:
        type: list
        description: "values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. This array is replaced during a strategic merge patch."
        required: false
        entry_schema:
          type: string
  org.alien4cloud.kubernetes.api.datatypes.autoscaler.HorizontalPodAutoscalerScaleTargetRef:
    description: "see https://v1-7.docs.kubernetes.io/docs/api-reference/v1.7/#crossversionobjectreference-v2alpha1-autoscaling"
    derived_from: tosca.datatypes.Root
    properties:
      apiVersion:
        type: string
      kind:
        type: string
        description: "see https://git.k8s.io/community/contributors/devel/api-conventions.md#types-kinds"
      name:
        type: string
  org.alien4cloud.kubernetes.api.datatypes.autoscaler.ResourceMetricSource:
    description: "see https://v1-7.docs.kubernetes.io/docs/api-reference/v1.7/#resourcemetricsource-v2alpha1-autoscaling"
    derived_from: tosca.datatypes.Root
    properties:
      name:
        type: string
        required: false
      targetAverageUtilization:
        type: integer
        description: |
          Target average of the resource metric in term on percentage.
          Required if targetAverageValue is not set.
        required: false
      targetAverageValue:
        type: integer
        description: |
          Target average of the resource metric in term on raw value.
          Required if targetAverageUtilization is not set.
        required: false
  org.alien4cloud.kubernetes.api.datatypes.autoscaler.MetricSpec:
    description: "see https://v1-7.docs.kubernetes.io/docs/api-reference/v1.7/#metricspec-v2alpha1-autoscaling"
    derived_from: tosca.datatypes.Root
    properties:
      type:
        type: string
        description: "type is the type of metric source. It should match one of the fields below."
        required: false
        default: Resource
      resource:
        type: org.alien4cloud.kubernetes.api.datatypes.autoscaler.ResourceMetricSource
        description: |
          resource refers to a resource metric (such as those specified in requests and limits) known to Kubernetes
          describing each pod in the current scale target (e.g. CPU or memory).
        required: false
  org.alien4cloud.kubernetes.api.datatypes.autoscaler.HorizontalPodAutoscalerSpec:
    description: "see https://v1-7.docs.kubernetes.io/docs/api-reference/v1.7/#horizontalpodautoscalerspec-v2alpha1-autoscaling"
    derived_from: tosca.datatypes.Root
    properties:
      minReplicas:
        type: integer
        required: false
      maxReplicas:
        type: integer
        required: false
      metrics:
        type: list
        description: |
          metrics contains the specifications for which to use to calculate
          the desired replica count (the maximum replica count across all metrics will be used).
          The desired replica count is calculated multiplying the ratio between the target value and the current value by the current number of pods.
          Ergo, metrics used must decrease as the pod count is increased, and vice-versa.
          See the individual metric source types for more information about how each type of metric must respond
        required: false
        entry_schema:
          type: org.alien4cloud.kubernetes.api.datatypes.autoscaler.MetricSpec
  org.alien4cloud.kubernetes.api.datatypes.volumes.EmptyDirVolumeSpec:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      medium:
        type: string
        description: "What type of storage medium should back this directory. The default is \"\" which means to use the node's default medium. Must be an empty string (default) or Memory. More info: https://kubernetes.io/docs/concepts/storage/volumes#emptydir"
        required: false
      sizeLimit:
        type: string
        description: |
          Total amount of local storage required for this EmptyDir volume.
          The size limit is also applicable for memory medium.
          The maximum usage on memory medium EmptyDir would be the minimum value between the SizeLimit specified here and the sum of memory limits of all containers in a pod.
          The default is nil which means that the limit is undefined.
          More info: http://kubernetes.io/docs/user-guide/volumes#emptydir
        required: false
  org.alien4cloud.kubernetes.api.datatypes.volumes.HostPathVolumeSpec:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      path:
        type: string
        description: "Path of the directory on the host. If the path is a symlink, it will follow the link to the real path. More info: https://kubernetes.io/docs/concepts/storage/volumes#hostpath"
  org.alien4cloud.kubernetes.api.datatypes.volumes.AWSElasticBlockStoreVolumeSpec:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      fsType:
        type: string
        description: "Filesystem type of the volume that you want to mount. Tip: Ensure that the filesystem type is supported by the host operating system. Examples: \"ext4\", \"xfs\", \"ntfs\". Implicitly inferred to be \"ext4\" if unspecified. More info: http://kubernetes.io/docs/user-guide/volumes#awselasticblockstore"
        required: false
      partition:
        type: integer
        description: "The partition in the volume that you want to mount. If omitted, the default is to mount by volume name. Examples: For volume /dev/sda1, you specify the partition as \"1\". Similarly, the volume partition for /dev/sda is \"0\" (or you can leave the property empty)."
        required: false
      readOnly:
        type: boolean
        description: "Specify \"true\" to force and set the ReadOnly property in VolumeMounts to \"true\". If omitted, the default is \"false\". More info: http://kubernetes.io/docs/user-guide/volumes#awselasticblockstore"
        required: false
        default: false
      volumeID:
        type: string
        description: "Unique ID of the persistent disk resource in AWS (Amazon EBS volume). More info: http://kubernetes.io/docs/user-guide/volumes#awselasticblockstore"
  org.alien4cloud.kubernetes.api.datatypes.volumes.PersistentVolumeClaimSpec:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      claimName:
        type: string
        description: "ClaimName is the name of a PersistentVolumeClaim in the same namespace as the pod using this volume. More info: https://kubernetes.io/docs/concepts/storage/persistent-volumes#persistentvolumeclaims"
        required: false
      readOnly:
        type: boolean
        description: "Will force the ReadOnly setting in VolumeMounts. Default false."
        required: false
        default: false
  org.alien4cloud.kubernetes.api.datatypes.volumes.ConfigMapVolumeSpec:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      name:
        type: string
        description: "The name of the ConfigMap : You must create a ConfigMap before you can use it."
  org.alien4cloud.kubernetes.api.datatypes.volumes.KeyToPath:
    description: "null"
    derived_from: tosca.datatypes.Root
    properties:
      key:
        type: string
        description: "The key to project."
      mode:
        type: integer
        description: "Optional: mode bits to use on created files by default. Must be a value between 0 and 0777. Defaults to 0644. Directories within the path are not affected by this setting. This might be in conflict with other options that affect the file mode, like fsGroup, and the result can be other mode bits set.        required: false"
        required: false
      path:
        type: string
        description: "The relative path of the file to map the key to. May not be an absolute path. May not contain the path element '..'. May not start with the string '..'."
  org.alien4cloud.kubernetes.api.datatypes.volumes.SecretVolumeSpec:
    description: "see https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#secretvolumesource-v1-core"
    derived_from: tosca.datatypes.Root
    properties:
      defaultMode:
        type: integer
        description: "Optional: mode bits to use on created files by default. Must be a value between 0 and 0777. Defaults to 0644. Directories within the path are not affected by this setting. This might be in conflict with other options that affect the file mode, like fsGroup, and the result can be other mode bits set.        required: false"
        required: false
        default: 644
      items:
        type: list
        required: false
        entry_schema:
          type: org.alien4cloud.kubernetes.api.datatypes.volumes.KeyToPath
      optional:
        type: boolean
        description: "Specify whether the Secret or it's keys must be defined"
        default: false
      secretName:
        type: string
        description: "Name of the secret in the pod's namespace to use. More info: https://kubernetes.io/docs/concepts/storage/volumes#secret"

node_types:
  org.alien4cloud.kubernetes.api.types.ConfigMapFactory:
    description: "Component in charge of creating a configMap using a container (of type ConfigurableDockerContainer) inputs."
    derived_from: org.alien4cloud.kubernetes.api.types.BaseResource
    properties:
      name:
        type: string
        description: "The name of the configMap"
      service_dependency_lookups:
        type: string
        description: |
          A CSV key:value pairs where key should be replaced by the interpretation of value in the JSON.
          The value is the Kube name of the service for which the scheduler will need to find the ClusterIP and
          replace the key in the JSON with the found value.
        required: false
      input_variables:
        type: map
        description: "The variables names and values that should be replaced in the files"
        entry_schema:
          type: string
    interfaces:
      Standard:
        create:
          inputs:
            CONFIGMAP_NAME: { get_property: [SELF, name] }
            INPUT_VARIABLES: { get_property: [SELF, input_variables] }
            KUBE_SERVICE_DEPENDENCIES: { get_property: [SELF, service_dependency_lookups] }
            NAMESPACE: { get_property: [SELF, namespace] }
          implementation: scripts/kubectl_configmap_create.sh
        delete:
          inputs:
            CONFIGMAP_NAME: { get_attribute: [SELF, name] }
            NAMESPACE: { get_property: [SELF, namespace] }
          implementation: scripts/kubectl_configmap_delete.sh
    artifacts:
      configs:
        file: configs
        type: tosca.artifacts.File
  org.alien4cloud.kubernetes.api.types.Base:
    description: "c.f. https://kubernetes.io/docs/api-reference/v1.6/#deployment-v1beta1-apps"
    derived_from: tosca.nodes.Root
    properties:
      apiVersion:
        type: string
        description: "APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: http://releases.k8s.io/HEAD/docs/devel/api-conventions.md#resources"
      kind:
        type: string
        description: "Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: http://releases.k8s.io/HEAD/docs/devel/api-conventions.md#types-kinds"
      metadata:
        type: map
        description: "Standard object's metadata. More info: http://releases.k8s.io/HEAD/docs/devel/api-conventions.md#metadata"
        required: false
        entry_schema:
          type: string
  org.alien4cloud.kubernetes.api.types.volume.AbstractVolumeBase:
    description: "https://v1-6.docs.kubernetes.io/docs/api-reference/v1.6/#volume-v1-core"
    derived_from: tosca.nodes.Root
    properties:
      name:
        type: string
      size:
        type: scalar-unit.size
        description: "The requested storage size (default unit is MB)."
    requirements:
      - attachment:
          capability: org.alien4cloud.capabilities.DockerVolumeAttachment
          relationship: org.alien4cloud.relationships.MountDockerVolume
          occurrences: [1, UNBOUNDED]
      - host:
          capability: tosca.capabilities.Container
          relationship: tosca.relationships.HostedOn
  org.alien4cloud.kubernetes.api.types.volume.VolumeBase:
    description: "null"
    derived_from: org.alien4cloud.kubernetes.api.types.volume.AbstractVolumeBase
    properties:
      volume_type:
        type: string
      spec:
        type: tosca.datatypes.Root
        description: "may be overriden by concrete implementations"
        required: false
  org.alien4cloud.kubernetes.api.types.volume.AbstractArtifactVolumeBase:
    description: "A volume linked to an artifact"
    derived_from: org.alien4cloud.kubernetes.api.types.volume.AbstractVolumeBase
    artifacts:
      resources:
        file: README.md
        type: tosca.artifacts.File
  org.alien4cloud.kubernetes.api.types.volume.ArtifactVolumeBase:
    description: "null"
    derived_from: org.alien4cloud.kubernetes.api.types.volume.AbstractArtifactVolumeBase
    properties:
      volume_type:
        type: string
      spec:
        type: tosca.datatypes.Root
        description: "may be overriden by concrete implementations"
        required: false
    artifacts:
      resources:
        file: README.md
        type: tosca.artifacts.File
  org.alien4cloud.kubernetes.api.types.volume.EmptyDirVolumeSource:
    description: |
      An emptyDir volume is first created when a Pod is assigned to a Node, and exists as long as that Pod is running on that node.
      As the name says, it is initially empty.
      Containers in the pod can all read and write the same files in the emptyDir volume, though that volume can be mounted at the same or different paths in each container.
      When a Pod is removed from a node for any reason, the data in the emptyDir is deleted forever.
    derived_from: org.alien4cloud.kubernetes.api.types.volume.VolumeBase
    properties:
      volume_type:
        type: string
        default: emptyDir
      spec:
        type: org.alien4cloud.kubernetes.api.datatypes.volumes.EmptyDirVolumeSpec
        required: false
  org.alien4cloud.kubernetes.api.types.volume.HostPathVolumeSource:
    description: |
      HostPath represents a pre-existing file or directory on the host machine that is directly exposed to the container.
      This is generally used for system agents or other privileged things that are allowed to see the host machine.
      Most containers will NOT need this.
      More info: https://kubernetes.io/docs/concepts/storage/volumes#hostpath
    derived_from: org.alien4cloud.kubernetes.api.types.volume.VolumeBase
    properties:
      volume_type:
        type: string
        default: hostPath
      spec:
        type: org.alien4cloud.kubernetes.api.datatypes.volumes.HostPathVolumeSpec
        required: false
  org.alien4cloud.kubernetes.api.types.volume.AWSElasticBlockStoreVolumeSource:
    description: |
      AWSElasticBlockStore represents an AWS Disk resource that is attached to a kubelet's host machine and then exposed to the pod.
      More info: https://kubernetes.io/docs/concepts/storage/volumes#awselasticblockstore
    derived_from: org.alien4cloud.kubernetes.api.types.volume.VolumeBase
    properties:
      volume_type:
        type: string
        default: awsElasticBlockStore
      spec:
        type: org.alien4cloud.kubernetes.api.datatypes.volumes.AWSElasticBlockStoreVolumeSpec
        required: false
  org.alien4cloud.kubernetes.api.types.volume.PersistentVolumeClaimSource:
    description: |
      PersistentVolumeClaimVolumeSource represents a reference to a PersistentVolumeClaim in the same namespace.
      More info: https://kubernetes.io/docs/concepts/storage/persistent-volumes#persistentvolumeclaims
    derived_from: org.alien4cloud.kubernetes.api.types.volume.VolumeBase
    properties:
      volume_type:
        type: string
        default: persistentVolumeClaim
      spec:
        type: org.alien4cloud.kubernetes.api.datatypes.volumes.PersistentVolumeClaimSpec
        required: false
      accessModes:
        type: string
        description: |
          AccessModes contains the desired access modes the volume should have.
          More info: https://kubernetes.io/docs/concepts/storage/persistent-volumes#access-modes-1
        default: ReadWriteOnce
  org.alien4cloud.kubernetes.api.types.volume.PersistentVolumeClaimStorageClassSource:
    description: |
      An extension of PersistentVolumeClaimSource that allows to specify a storageClass.
      If no volume that match this claim is found in the PersistentVolume pool, a volume will be allocated in the IAAS.
      When using this kind of volume, your Kube admin should ensure to have a storageClass defined in the cluster.
    derived_from: org.alien4cloud.kubernetes.api.types.volume.PersistentVolumeClaimSource
    properties:
      storageClassName:
        type: string
        default: default
  org.alien4cloud.kubernetes.api.types.volume.ConfigMapSource:
    description: |
      The configMap resource provides a way to inject configuration data into Pods.
      More info: https://kubernetes.io/docs/concepts/storage/#configmap
    derived_from: org.alien4cloud.kubernetes.api.types.volume.VolumeBase
    properties:
      volume_type:
        type: string
        default: configMap
      spec:
        type: org.alien4cloud.kubernetes.api.datatypes.volumes.ConfigMapVolumeSpec
        required: false
  org.alien4cloud.kubernetes.api.types.volume.SecretSource:
    description: |
      Adapts a Secret into a volume. The contents of the target Secret's Data field will be presented in a volume as files using the keys in the Data field as the file names. Secret volumes support ownership management and SELinux relabeling.
      More info: https://kubernetes.io/docs/concepts/configuration/secret/
    derived_from: org.alien4cloud.kubernetes.api.types.volume.ArtifactVolumeBase
    properties:
      volume_type:
        type: string
        default: secret
      spec:
        type: org.alien4cloud.kubernetes.api.datatypes.volumes.SecretVolumeSpec
        required: false
  org.alien4cloud.kubernetes.api.types.SecretFactory:
    description: "Component in charge of creating a secret using one or more files (from an artifact)."
    derived_from: org.alien4cloud.kubernetes.api.types.BaseResource
    properties:
      name:
        type: string
        description: "The name of the secret"
    interfaces:
      Standard:
        create:
          inputs:
            SECRET_NAME: { get_property: [SELF, name] }
            NAMESPACE: { get_property: [SELF, namespace] }
          implementation: scripts/kubectl_secret_create.sh
        delete:
          inputs:
            SECRET_NAME: { get_property: [SELF, name] }
            NAMESPACE: { get_property: [SELF, namespace] }
          implementation: scripts/kubectl_secret_delete.sh
    artifacts:
      resources:
        file: README.md
        type: tosca.artifacts.File
  org.alien4cloud.kubernetes.api.types.Service:
    description: "null"
    derived_from: org.alien4cloud.kubernetes.api.types.AbstractService
  org.alien4cloud.kubernetes.api.types.IngressService:
    description: |
      This kind of service can be used of you want to expose your service using the Ingress controler.
      If tls_crt AND tls_key are set, the Ingress will be secured using a secret.
    derived_from: org.alien4cloud.kubernetes.api.types.Service
    properties:
      host:
        type: string
        description: "The dns name for the ingress."
      tls_crt:
        type: string
        description: "Optionnal base64 encoded certificate (if TLS need to be set for the ingress)"
        required: false
      tls_key:
        type: string
        description: "Optionnal base64 encoded key (if TLS need to be set for the ingress)"
        required: false
  org.alien4cloud.kubernetes.api.types.AbstractService:
    description: "Represent a kubernetes Service"
    derived_from: org.alien4cloud.kubernetes.api.types.Base
    properties:
      service_name:
        type: string
        description: |
          Usually, the service name is generated by the plugin. If you need to define a static service name, you can define it using this property.
          253 characters and consist of lower case alphanumeric characters, -, and .
        required: false
      apiVersion:
        type: string
        description: "APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: http://releases.k8s.io/HEAD/docs/devel/api-conventions.md#resources"
        default: v1
      kind:
        type: string
        description: "Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: http://releases.k8s.io/HEAD/docs/devel/api-conventions.md#types-kinds"
        default: Service
      spec:
        type: org.alien4cloud.kubernetes.api.datatypes.ServiceSpec
  org.alien4cloud.kubernetes.api.types.Deployment:
    description: "null"
    derived_from: org.alien4cloud.kubernetes.api.types.AbstractDeployment
  org.alien4cloud.kubernetes.api.types.AbstractDeployment:
    description: "Represent a kubernetes Deployment"
    derived_from: org.alien4cloud.kubernetes.api.types.Base
    properties:
      apiVersion:
        type: string
        description: "APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: http://releases.k8s.io/HEAD/docs/devel/api-conventions.md#resources"
        default: "apps/v1beta1"
      kind:
        type: string
        description: "Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: http://releases.k8s.io/HEAD/docs/devel/api-conventions.md#types-kinds"
        default: Deployment
      spec:
        type: org.alien4cloud.kubernetes.api.datatypes.DeploymentSpec
    capabilities:
      host:
        type: tosca.capabilities.Container.Docker
      scalable:
        type: tosca.capabilities.Scalable
  org.alien4cloud.kubernetes.api.types.Job:
    description: "null"
    derived_from: org.alien4cloud.kubernetes.api.types.AbstractJob
  org.alien4cloud.kubernetes.api.types.AbstractJob:
    description: "Represent a kubernetes Job"
    derived_from: org.alien4cloud.kubernetes.api.types.Base
    properties:
      apiVersion:
        type: string
        description: "APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: http://releases.k8s.io/HEAD/docs/devel/api-conventions.md#resources"
        default: "batch/v1"
      kind:
        type: string
        description: "Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: http://releases.k8s.io/HEAD/docs/devel/api-conventions.md#types-kinds"
        default: Job
      spec:
        type: org.alien4cloud.kubernetes.api.datatypes.JobSpec
    capabilities:
      host:
        type: tosca.capabilities.Container.Docker
  org.alien4cloud.kubernetes.api.types.HorizontalPodAutoscaler:
    description: |
      A kubernetes HorizontalPodAutoscaler object
      see https://v1-7.docs.kubernetes.io/docs/api-reference/v1.7/#horizontalpodautoscaler-v2alpha1-autoscaling
    derived_from: org.alien4cloud.kubernetes.api.types.Base
    properties:
      apiVersion:
        type: string
        default: "autoscaling/v2alpha1"
      kind:
        type: string
        default: HorizontalPodAutoscaler
      spec:
        type: org.alien4cloud.kubernetes.api.datatypes.autoscaler.HorizontalPodAutoscalerSpec
  org.alien4cloud.kubernetes.api.types.Container:
    description: "null"
    derived_from: org.alien4cloud.kubernetes.api.types.AbstractContainer
  org.alien4cloud.kubernetes.api.types.AbstractContainer:
    description: "Represent a kubernetes ContainerSpec."
    derived_from: org.alien4cloud.extended.container.types.ContainerRuntime
    properties:
      container:
        type: org.alien4cloud.kubernetes.api.datatypes.ContainerSpec
      repository:
        type: string
        description: "This property can be specified to select from which repository the image will be pulled. The kubernetes image will be the concatenation of this property to the image property: {repository}/{image} Note that you may want to define imagePullSecrets references so kubernetes uses the right repository credentials. This property must be configured on the Deployment object."
  org.alien4cloud.kubernetes.api.types.BaseResource:
    description: "Represent a kubernetes final resource after node matching (Pod, ReplicaSet or Deployment)"
    derived_from: tosca.nodes.Root
    properties:
      namespace:
        type: string
        description: "The namespace where the resource is deployed."
        required: false
      resource_spec:
        type: string
        description: |
          The the JSON serialization (and eventually transformation) of initial node properties.
          This JSON can be used to instanciate the resource on the K8S cluster.
  org.alien4cloud.kubernetes.api.types.DeploymentResource:
    description: "null"
    derived_from: org.alien4cloud.kubernetes.api.types.BaseResource
    properties:
      resource_id:
        type: string
        description: "a unique id set by a4c to identify a resource. it should be added as a label named 'a4c_id'"
      service_dependency_lookups:
        type: string
        description: |
          A CSV key:value pairs where key should be replaced by the interpretation of value in the JSON.
          The value is the Kube name of the service for which the scheduler will need to find the ClusterIP and
          replace the key in the JSON with the found value.
        required: false
    attributes:
      deployment_id: { get_operation_output: [SELF, Standard, create, KUBE_DEPLOYMENT_ID] }
    interfaces:
      org.alien4cloud.management.ClusterControl:
        scale:
          inputs:
            KUBE_DEPLOYMENT_ID: { get_attribute: [SELF, deployment_id] }
            NAMESPACE: { get_property: [SELF, namespace] }
            EXPECTED_INSTANCES: 
              type: integer

            INSTANCES_DELTA: 
              type: integer

          implementation: scripts/kubectl_deployment_scale.sh
      Standard:
        create:
          inputs:
            KUBE_SERVICE_DEPENDENCIES: { get_property: [SELF, service_dependency_lookups] }
            KUBE_RESOURCE_DEPLOYMENT_CONFIG: { get_property: [SELF, resource_spec] }
            NAMESPACE: { get_property: [SELF, namespace] }
          implementation: scripts/kubectl_deployment_create.sh
        delete:
          inputs:
            KUBE_DEPLOYMENT_ID: { get_property: [SELF, resource_id] }
            NAMESPACE: { get_property: [SELF, namespace] }
          implementation: scripts/kubectl_deployment_delete.sh
    capabilities:
      scalable:
        type: org.alien4cloud.capabilities.ClusterController
  org.alien4cloud.kubernetes.api.types.BaseJobResource:
    description: "Represent a Job kubernetes final resource after node matching"
    derived_from: org.alien4cloud.nodes.Job
    properties:
      namespace:
        type: string
        description: "The namespace where the resource is deployed."
        required: false
      resource_spec:
        type: string
        description: |
          The the JSON serialization (and eventually transformation) of initial node properties.
          This JSON can be used to instanciate the resource on the K8S cluster.
  org.alien4cloud.kubernetes.api.types.JobResource:
    description: "null"
    derived_from: org.alien4cloud.kubernetes.api.types.BaseJobResource
    interfaces:
      tosca.interfaces.node.lifecycle.Runnable:
        cancel: scripts/kubectl_job_cancel.sh
        submit:
          inputs:
            KUBE_RESOURCE_JOB_CONFIG: { get_property: [SELF, resource_spec] }
          implementation: scripts/kubectl_job_submit.sh
        run: scripts/kubectl_job_run.sh
  org.alien4cloud.kubernetes.api.types.EndpointResource:
    description: "null"
    derived_from: org.alien4cloud.kubernetes.api.types.BaseResource
    properties:
      resource_id:
        type: string
        description: "a unique id set by a4c to identify a resource. it should be added as a label named 'a4c_id'"
      subsets:
        type: list
        entry_schema:
          type: org.alien4cloud.kubernetes.api.datatypes.EndpointSubsets
    attributes:
      spec_path: { get_operation_output: [SELF, Standard, create, KUBE_SPEC_PATH] }
    interfaces:
      Standard:
        start:
          inputs:
            KUBE_RESOURCE_ID: { get_property: [SELF, resource_id] }
            KUBE_SPEC_PATH: { get_attribute: [SELF, spec_path] }
            NAMESPACE: { get_property: [SELF, namespace] }
          implementation: scripts/kubectl_endpoint_start.sh
        create:
          inputs:
            KUBE_RESOURCE_CONFIG: { get_property: [SELF, resource_spec] }
            NAMESPACE: { get_property: [SELF, namespace] }
          implementation: scripts/kubectl_endpoint_create.sh
        delete:
          inputs:
            KUBE_RESOURCE_TYPE: endpoints
            KUBE_RESOURCE_ID: { get_attribute: [SELF, resource_id] }
            NAMESPACE: { get_property: [SELF, namespace] }
          implementation: scripts/kubectl_resource_wrapper_uninstall.sh
    requirements:
      - endpoint:
          capability: tosca.capabilities.Endpoint
          relationship: org.alien4cloud.kubernetes.api.relationships.K8SEndpointConnectToEndpoint
  org.alien4cloud.kubernetes.api.types.ServiceResource:
    description: "null"
    derived_from: org.alien4cloud.kubernetes.api.types.BaseResource
    properties:
      service_name:
        type: string
    attributes:
      ip_address: { get_operation_output: [SELF, Standard, create, IP_ADDRESS] }
      port: { get_operation_output: [SELF, Standard, create, PORT] }
      node_port: { get_operation_output: [SELF, Standard, create, NODE_PORT] }
    interfaces:
      Standard:
        create:
          inputs:
            KUBE_SERVICE_NAME: { get_property: [SELF, service_name] }
            KUBE_SERVICE_CONFIG: { get_property: [SELF, resource_spec] }
            NAMESPACE: { get_property: [SELF, namespace] }
          implementation: scripts/kubectl_service_wrapper.sh
        delete:
          inputs:
            KUBE_SERVICE_NAME: { get_property: [SELF, service_name] }
            NAMESPACE: { get_property: [SELF, namespace] }
          implementation: scripts/kubectl_service_wrapper_uninstall.sh
    capabilities:
      cluster_endpoint:
        type: tosca.capabilities.Endpoint
  org.alien4cloud.kubernetes.api.types.SimpleResource:
    description: "A generic resource used to deploy any kind of resource on the kube cluster."
    derived_from: org.alien4cloud.kubernetes.api.types.BaseResource
    properties:
      resource_type:
        type: string
        description: "The resource type known by K8S examples: pod,service,pv,pvc"
      resource_id:
        type: string
        description: "a unique id set by a4c to identify a resource. it should be added as a label named 'a4c_id'"
      json_path_expr:
        type: string
        description: "the JSON path expression that will get the expected output to check resource avalaibility"
        required: false
      json_path_value:
        type: string
        description: "the value excpected to obtain using the JSON path expression to check resource avalaibility"
        required: false
    interfaces:
      Standard:
        create:
          inputs:
            KUBE_RESOURCE_TYPE: { get_property: [SELF, resource_type] }
            KUBE_RESOURCE_ID: { get_property: [SELF, resource_id] }
            KUBE_RESOURCE_CONFIG: { get_property: [SELF, resource_spec] }
            KUBE_JSON_PATH_EXPR: { get_property: [SELF, json_path_expr] }
            KUBE_JSON_PATH_VALUE: { get_property: [SELF, json_path_value] }
            NAMESPACE: { get_property: [SELF, namespace] }
          implementation: scripts/kubectl_resource_wrapper.sh
        delete:
          inputs:
            KUBE_RESOURCE_TYPE: { get_property: [SELF, resource_type] }
            KUBE_RESOURCE_ID: { get_property: [SELF, resource_id] }
            NAMESPACE: { get_property: [SELF, namespace] }
          implementation: scripts/kubectl_resource_wrapper_uninstall.sh

relationship_types:
  org.alien4cloud.kubernetes.api.relationships.K8SEndpointConnectToEndpoint:
    description: "This type represents relationship between a K8S endpoint and an external endpoint."
    derived_from: tosca.relationships.ConnectsTo
    interfaces:
      Configure:
        pre_configure_source:
          inputs:
            KUBE_SPEC_PATH: { get_attribute: [SOURCE, spec_path] }
            TARGET_IP_ADDRESS: { get_attribute: [TARGET, ip_address] }
          implementation: scripts/kubectl_endpoint_join.sh
    valid_source_types: ["tosca.capabilities.Endpoint"]

policy_types:
  org.alien4cloud.kubernetes.api.policies.AntiAffinityLabel:
    metadata:
      a4c_policy_impl: "alien4cloud-kubernetes-plugin:kubernetes-anti-affinity-modifier:post-node-match"
    description: "c.f. https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity"
    derived_from: org.alien4cloud.policies.AntiAffinity
  org.alien4cloud.kubernetes.api.policies.AutoscalingPolicy:
    description: "c.f. https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/"
    derived_from: tosca.policies.Scaling
    properties:
      spec:
        type: org.alien4cloud.kubernetes.api.datatypes.autoscaler.HorizontalPodAutoscalerSpec
  org.alien4cloud.kubernetes.api.policies.NodeAffinityLabel:
    metadata:
      a4c_policy_impl: "alien4cloud-kubernetes-plugin:kubernetes-node-affinity-modifier:post-node-match"
    description: "c.f. https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#node-affinity-beta-feature"
    derived_from: org.alien4cloud.policies.LabelPlacement
    properties:
      matchExpressions:
        type: list
        description: |
          matchExpressions is a list of node selector requirements. The requirements are ANDed.
          Note that the "labels" property value will be used mostly for matching the topology policy against this one.
          The value filled in this property will be the actual one in the final kubernetes blueprint.
        required: false
        entry_schema:
          type: org.alien4cloud.kubernetes.api.datatypes.NodeSelectorRequirement
