tosca_definitions_version: yorc_tosca_simple_yaml_1_0

metadata:
  template_name: yorc-hostspool-types
  template_author: yorc
  template_version: 1.1.0

imports:
  - yorc: <yorc-types.yml>

node_types:
  yorc.nodes.hostspool.Compute:
    derived_from: yorc.nodes.Compute
    properties:
      shareable:
        type: boolean
        description: Can the compute node be shared
        required: false
        default: false
      filters:
        type: list
        description: Filters to select hosts from their labels
        entry_schema:
          type: string
        required: false
    attributes:
      hostname:
        type: string
        description: Hostname as known in the hosts pool
    capabilities:
      endpoint:
        type: yorc.capabilities.Endpoint.ProvisioningAdmin
        properties:
          credentials:
            user: "not significant, will be set by yorc itself"
      host:
        type: yorc.capabilities.hostspool.Container

policy_types:
  yorc.policies.hostspool.Placement:
    abstract: true
    derived_from: tosca.policies.Placement
    description: The yorc hostpool TOSCA Policy Placement.

  yorc.policies.hostspool.WeightBalancedPlacement:
    derived_from: yorc.policies.hostspool.Placement
    description: >
      The yorc hostpool TOSCA Policy placement which allows to allocate a host with a weight-balanced algorithm.
      It means the host the less allocated will be elect preferentially.
    targets: [ tosca.nodes.Compute ]

  yorc.policies.hostspool.BinPackingPlacement:
    derived_from: yorc.policies.hostspool.Placement
    description: >
      The yorc hostpool TOSCA Policy placement which allows to allocate a host with a bin packing algorithm.
      It means the host the more allocated will be elect preferentially.
    targets: [ tosca.nodes.Compute ]

capability_types:
  yorc.capabilities.hostspool.Container:
    derived_from: tosca.capabilities.Container
    properties:
      generic_resources:
        type: list
        description: >
          A list of generic resources that the container must provide.
        entry_schema:
          type: yorc.datatypes.hostspool.GenericResource
        required: false

data_types:
  yorc.datatypes.hostspool.GenericResource:
    derived_from: tosca.datatypes.Root
    properties:
      name:
        type: string
        required: true
        description: >
          The name of the generic resource. Can be "gpu" and must be bound to host labels as: host.generic_resource.
      ids:
        type: string
        required: false
        description: >
          Comma-separated list of required generic resource ID's. Either ids or number must be filled to define the resource need.
          Both ids and number can be filled if you want to precise only a few ids of the total number of required resources.
          It's bound to label host.generic_resource.<name>
      number:
        type: integer
        required: false
        description: >
          The number of generic resource required.  Either ids or number must be filled to define the resource need.
          Both ids and number can be filled if you want to precise only a few ids of the total number of required resources.
          It's bound to label host.generic_resource.<name>.nb
      no_consumable:
        type: boolean
        default: false
        description: >
          By default, the generic resource is consumable. It means a resource can be only used by a single compute.
          If you allow the resource to be shared by multiple computes, you have to set this property to true.
          It's bound to label host.generic_resource.<name>.no_consumable
