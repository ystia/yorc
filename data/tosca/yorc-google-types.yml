tosca_definitions_version: yorc_tosca_simple_yaml_1_0

metadata:
  template_name: yorc-google-types
  template_author: yorc
  template_version: 1.0.0

imports:
  - yorc: <yorc-types.yml>

artifact_types:
  yorc.artifacts.google.Deployment.Address:
    derived_from: tosca.artifacts.Deployment

node_types:
  yorc.nodes.google.Compute:
    derived_from: yorc.nodes.Compute
    description: >
      Google Compute Engine Virtual Machine (Compute Instance)
    properties:
      # See definitions at:
      # https://cloud.google.com/compute/docs/reference/rest/v1/instances
      image_project:
        type: string
        description: >
          The project against which all image and image family references will be
          resolved.
          If not specified, and either image or image_family is provided, the current
          default project is used.
          At least one of the tuples image_project/image_family, image_project/image, family, image, should be defined.
        required: false
      image_family:
        type: string
        description: >
          The family of the image from which to initialize the boot disk.
          When a family is specified instead of an image, the latest non-deprecated 
          image associated with that family is used.
          At least one of the tuples image_project/image_family, image_project/image, family, image, should be defined.
        required: false
      image:
        type: string
        description: >
          Image from which to initialize the boot disk.
          If not specified, and an image family is specified, the latest 
          non-deprecated image associated with that family is used.
          At least one of the tuples image_project/image_family, image_project/image, family, image, should be defined.
        required: false
      machine_type:
        type: string
        description: >
          The machine type used for the Compute Node, defining the Compute Node 
          CPU and Memory resources.
        default: n1-standard-1
      zone:
        type: string
        description: >
          The zone on which the Compute Node should be hosted.
      description:
        type: string
        description: >
          Textual description of this Compute Node.
        required: false
      labels:
        type: string
        description: >
          Comma-separated list of label KEY=VALUE pairs to assign to the Compute Node. 
        required: false
      metadata:
        type: string
        description: >
          Comma-separated list of label KEY=VALUE pairs made available to the
          Compute Node Operating System. On Google official images, the metadata
          keys startup-script or startup-script-url can be used to specify a script
          that will be executed by the Compute Node once it starts running.
        required: false
      no_address:
        type: boolean
        description: >
          If set to true, the instance will not be assigned an external IP address
        required: false
      preemptible:
        type: boolean
        description: >
          If set to true, the Compute Node is preemptible and time-limited.
        required: false
      scopes:
        type: string
        description: >
          Comma-separated list of service scopes defining access to Google Cloud APIs.
          A scope can be either the full URI of the scope or an alias, like
          cloud-platform.
        required: false
      service_account:
        type: string
        description: >
          Service Account (e-mail or alias) to attach to the Compute Node.
          If not provided, the Compute Node will get the project default service
          account. 
        required: false
      tags:
        type: string
        description: >
          Comma-separated list of tags to apply to the instances for identifying
          the instances to which network firewall rules will apply.
        required: false
    requirements:
      - assignment:
          capability: yorc.capabilities.Assignable
          node: yorc.nodes.google.StaticIP
          relationship: yorc.relationships.AssignsTo
          occurrences: [0, UNBOUNDED]

  yorc.nodes.google.Network:
    derived_from: tosca.nodes.Network

  yorc.nodes.google.StaticIP:
    derived_from: tosca.nodes.Root
    properties:
    # See https://www.terraform.io/docs/providers/google/r/compute_address.html
      name:
        type: string
        description: >
          Name of the resource. The name must be 1-63 characters long, and comply with RFC1035.
          Specifically, the name must be 1-63 characters long and match the regular expression [a-z]([-a-z0-9]*[a-z0-9])?
          which means the first character must be a lowercase letter, and all following characters must be a dash, lowercase letter, or digit, except the last character, which cannot be a dash.
        required: true
      addresses:
        type: string
        description: >
          Comma-separated list of static external addresses. Only IPv4 is supported.
          The IP address must be inside the specified subnetwork, if any.
        required: false
      labels:
        type: string
        description: >
          Comma-separated list of label KEY=VALUE pairs to assign to the Compute Address.
        required: false
    capabilities:
      assignment:
        type: yorc.capabilities.Assignable
    interfaces:
      Standard:
        create:
          implementation:
            file: "embedded"
            type: yorc.artifacts.google.Deployment.Address
        delete:
          implementation:
            file: "embedded"
            type: yorc.artifacts.google.Deployment.Address

